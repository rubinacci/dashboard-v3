{"ast":null,"code":"var _jsxFileName = \"/Users/nco/Documents/GitHub/dashboard/src/Components/Wallet/Wallet.tsx\";\nimport React, { useEffect, useState } from 'react';\nimport classes from './Wallet.module.scss';\nimport StaButton from '../StaButton/StaButton';\nimport { useWeb3React } from '@web3-react/core';\nimport { injected, walletConnect } from '../../web3/connectors';\nimport Big from 'big.js';\nimport { POOLS, ASSETS } from '../../Constants/Constants';\nimport _ from 'lodash';\nimport { InjectedConnector } from '@web3-react/injected-connector';\nimport { formatEther, formatUnits } from '@ethersproject/units';\nimport useEthSWR, { EthSWRConfig } from 'ether-swr';\nimport ERC20ABI from '../../Constants/ERC20.abi.json';\nimport useEtherSWR from 'ether-swr/esm';\nimport { genFormattedNumber } from '../../util/numberFormat';\nimport WalletStatus from '../WalletStatus/WalletStatus';\nimport cx from 'classnames';\nimport { useCookies } from 'react-cookie';\nexport const Networks = {\n  MainNet: 1\n};\nexport const TOKENS_BY_NETWORK = {\n  [Networks.MainNet]: ASSETS.filter(item => item.ticker !== 'ETH').map(item => ({\n    name: item.name,\n    symbol: item.ticker,\n    address: item.contractAddress,\n    decimals: 18\n  }))\n};\nexport const ABIs = chainId => {\n  const matrix = TOKENS_BY_NETWORK[chainId];\n  return Object.entries(matrix.reduce((memo, item) => {\n    return { ...memo,\n      [item.address]: ERC20ABI\n    };\n  }, {}));\n};\nexport const injectedConnector = new InjectedConnector({\n  supportedChainIds: [Networks.MainNet // Mainet\n  ]\n});\nexport const TokenList = ({\n  chainId,\n  assets\n}) => {\n  const {\n    account\n  } = useWeb3React();\n  const tokens = TOKENS_BY_NETWORK[chainId];\n  const {\n    data: balances\n  } = useEtherSWR(tokens.map(t => [t.address, 'balanceOf', account]));\n  let tokensIncludingBalances;\n\n  if (balances) {\n    tokensIncludingBalances = TOKENS_BY_NETWORK[chainId].map((token, index) => ({ ...token,\n      balance: balances[index]\n    }));\n  }\n\n  if (tokensIncludingBalances) {\n    return /*#__PURE__*/React.createElement(\"table\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 7\n      }\n    }, tokensIncludingBalances.filter(token => _.some(assets, asset => asset.contractAddress === token.address)).map(token => /*#__PURE__*/React.createElement(TokenBalance, Object.assign({\n      key: token.address\n    }, token, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 27\n      }\n    }))));\n  } else {\n    return /*#__PURE__*/React.createElement(\"table\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 12\n      }\n    }, \"...\");\n  }\n};\nexport const EthBalance = () => {\n  const {\n    account\n  } = useWeb3React();\n  const {\n    data: balance,\n    mutate\n  } = useEthSWR(['getBalance', account, 'latest'], {\n    subscribe: [{\n      name: 'block',\n      on: event => {\n        // on every block we check if Ether balance has changed by re-fetching\n        mutate(undefined, true);\n      }\n    }]\n  });\n\n  if (!balance) {\n    return /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 12\n      }\n    }, \"...\");\n  }\n\n  return /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }\n  }, \"\\u039E\"), /*#__PURE__*/React.createElement(\"td\", {\n    className: classes.balance,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }\n  }, genFormattedNumber(Big(formatEther(balance)).toNumber(), 2)));\n};\nexport const TokenBalance = ({\n  symbol,\n  address,\n  decimals\n}) => {\n  const {\n    account\n  } = useWeb3React();\n  const {\n    data: balance,\n    mutate\n  } = useEthSWR([address, 'balanceOf', account], {\n    subscribe: [// A filter from anyone to me\n    {\n      name: 'Transfer',\n      topics: [null, account],\n      on: (state, fromAddress, toAddress, amount, event) => {\n        const update = state.add(amount);\n        mutate(update, false); // optimistic update skip re-fetch\n      }\n    }, // A filter from me to anyone\n    {\n      name: 'Transfer',\n      topics: [account, null],\n      on: (state, fromAddress, toAddress, amount, event) => {\n        const update = state.sub(amount);\n        mutate(update, false); // optimistic update skip re-fetch\n      }\n    }]\n  });\n\n  if (!balance) {\n    return /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 12\n      }\n    }, \"...\");\n  }\n\n  return /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }\n  }, symbol), /*#__PURE__*/React.createElement(\"td\", {\n    className: classes.balance,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }\n  }, genFormattedNumber(Big(formatUnits(balance, decimals)).toNumber(), 2)));\n};\n\nconst Wallet = props => {\n  const {\n    isStaPage,\n    poolContractAddress\n  } = props;\n  const [cookies, setCookie] = useCookies(['statera_dashboard_wallet_closed']);\n  const defaultWalletClosed = cookies.statera_dashboard_wallet_closed === '1' ? true : false;\n  const [walletClosed, setWalletClosed] = useState(defaultWalletClosed);\n  const {\n    chainId,\n    account,\n    library,\n    activate,\n    deactivate,\n    active\n  } = useWeb3React();\n\n  const onClick = () => {\n    activate(injectedConnector);\n  };\n\n  useEffect(() => {\n    props.onWalletChange(defaultWalletClosed);\n  }, []);\n\n  const handleWalletChange = status => {\n    setWalletClosed(status);\n    setCookie('statera_dashboard_wallet_closed', status ? '1' : '0', {\n      path: '/'\n    });\n    console.log('cookies: ', status, cookies.statera_dashboard_wallet_closed);\n    props.onWalletChange(status);\n  };\n\n  let poolAssets = [];\n  let currentPool;\n\n  if (isStaPage) {\n    poolAssets.push(ASSETS.find(item => item.ticker === 'STA'));\n    poolAssets.push(ASSETS.find(item => item.ticker === 'wSTA'));\n  } else {\n    let currentPool;\n\n    _.mapValues(POOLS, (value, key) => {\n      if (value.contractAddress === poolContractAddress) {\n        currentPool = value;\n      }\n    });\n\n    if (currentPool) {\n      currentPool.assets.forEach(item => {\n        poolAssets.push(ASSETS.find(assetItem => assetItem.contractAddress === item.contractAddress));\n      });\n    }\n  }\n\n  const ethBalanceDom = _.some(poolAssets, item => item.ticker === \"ETH\") ? /*#__PURE__*/React.createElement(EthBalance, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 77\n    }\n  }) : null;\n\n  if (active && chainId) {\n    let liquidityDom;\n\n    if (!isStaPage) {\n      liquidityDom = /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: classes.title,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }\n      }, \"Liquidity\"), /*#__PURE__*/React.createElement(TokenList, {\n        chainId: chainId,\n        assets: [ASSETS.find(item => item.contractAddress === poolContractAddress)],\n        isLiquidity: false,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 11\n        }\n      }));\n    }\n\n    let actionsDom;\n\n    if (isStaPage) {\n      actionsDom = /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: classes.title,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 11\n        }\n      }, \"Actions\"), /*#__PURE__*/React.createElement(StaButton, {\n        to: \"https://app.uniswap.org/#/swap?outputCurrency=0xa7de087329bfcda5639247f96140f9dabe3deed1\",\n        target: \"_blank\",\n        style: {\n          width: '100%',\n          marginBottom: '10px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 11\n        }\n      }, \"Trade STA\"), /*#__PURE__*/React.createElement(StaButton, {\n        to: \"https://app.uniswap.org/#/swap?outputCurrency=0xedeec5691f23e4914cf0183a4196bbeb30d027a0\",\n        target: \"_blank\",\n        style: {\n          width: '100%',\n          marginBottom: '10px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 11\n        }\n      }, \"Trade wSTA\"));\n    } else {\n      if (poolContractAddress === '0xa94700c1a1ae21324e78d5bdf6b2924e45a6068f') {\n        // Dual asset\n        // WARNING: Hardcoding links for STA/wSTA pool\n        // TOOD: refactor\n        actionsDom = /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: classes.title,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 280,\n            columnNumber: 13\n          }\n        }, \"Actions\"), /*#__PURE__*/React.createElement(StaButton, {\n          to: \"https://app.uniswap.org/#/add/0xa7de087329bfcda5639247f96140f9dabe3deed1/0xedeec5691f23e4914cf0183a4196bbeb30d027a0\",\n          target: \"_blank\",\n          style: {\n            width: '100%',\n            marginBottom: '10px'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 13\n          }\n        }, \"Add Liquidity\"), /*#__PURE__*/React.createElement(StaButton, {\n          to: \"https://app.uniswap.org/#/remove/0xa7de087329bfcda5639247f96140f9dabe3deed1/0xedeec5691f23e4914cf0183a4196bbeb30d027a0\",\n          target: \"_blank\",\n          style: {\n            width: '100%',\n            marginBottom: '10px'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 13\n          }\n        }, \"Remove Liquidity\"));\n      } else {\n        actionsDom = /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 306,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: classes.title,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 13\n          }\n        }, \"Actions\"), /*#__PURE__*/React.createElement(StaButton, {\n          to: `https://pools.balancer.exchange/#/pool/${poolContractAddress}`,\n          target: \"_blank\",\n          style: {\n            width: '100%',\n            marginBottom: '10px'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 13\n          }\n        }, \"Add/Remove Liquidity\"), /*#__PURE__*/React.createElement(StaButton, {\n          to: \"https://claim.balancer.finance\",\n          target: \"_blank\",\n          style: {\n            width: '100%',\n            marginBottom: '10px'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 13\n          }\n        }, \"Claim BAL Rewards\"));\n      }\n    }\n\n    return /*#__PURE__*/React.createElement(EthSWRConfig, {\n      value: {\n        provider: library,\n        ABIs: new Map(ABIs(chainId)),\n        refreshInterval: 30000\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: cx(classes.container, {\n        [classes.closed]: walletClosed\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.inner,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.header,\n      onClick: () => {\n        if (walletClosed) {\n          handleWalletChange(false);\n        }\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.walletStatus,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(WalletStatus, {\n      account: account,\n      onDisconnect: () => deactivate(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.headerTitle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 359,\n        columnNumber: 15\n      }\n    }, \"My Wallet\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.closeIcon,\n      onClick: () => handleWalletChange(!walletClosed),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.main,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.myWallet,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 17\n      }\n    }, \"Balances\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.tokenList,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 17\n      }\n    }, ethBalanceDom, /*#__PURE__*/React.createElement(TokenList, {\n      chainId: chainId,\n      assets: poolAssets,\n      isLiquidity: false,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 19\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.myLiquidity,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.tokenList,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 17\n      }\n    }, liquidityDom)), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.actions,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 15\n      }\n    }, actionsDom)))));\n  } else {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: cx(classes.container, classes.containerDisconnected, {\n        [classes.closed]: walletClosed\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.inner,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.header,\n      onClick: () => {\n        if (walletClosed) {\n          handleWalletChange(false);\n        }\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.walletStatus,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(WalletStatus, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.headerTitle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 13\n      }\n    }, \"My Wallet\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.closeIcon,\n      onClick: () => handleWalletChange(!walletClosed),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.connectContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.connectContainerText,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 13\n      }\n    }, \"Connect your wallet to see live balances and liquidity\"), /*#__PURE__*/React.createElement(StaButton, {\n      onClick: () => {\n        activate(injected);\n      },\n      style: {\n        margin: '0 6px 10px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 13\n      }\n    }, \"Connect with Metamask\"), /*#__PURE__*/React.createElement(StaButton, {\n      onClick: () => {\n        activate(walletConnect, undefined, true);\n      },\n      style: {\n        margin: '0 6px 10px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 428,\n        columnNumber: 13\n      }\n    }, \"Connect with Walletconnect\"))));\n  }\n};\n\nexport default Wallet;","map":{"version":3,"sources":["/Users/nco/Documents/GitHub/dashboard/src/Components/Wallet/Wallet.tsx"],"names":["React","useEffect","useState","classes","StaButton","useWeb3React","injected","walletConnect","Big","POOLS","ASSETS","_","InjectedConnector","formatEther","formatUnits","useEthSWR","EthSWRConfig","ERC20ABI","useEtherSWR","genFormattedNumber","WalletStatus","cx","useCookies","Networks","MainNet","TOKENS_BY_NETWORK","filter","item","ticker","map","name","symbol","address","contractAddress","decimals","ABIs","chainId","matrix","Object","entries","reduce","memo","injectedConnector","supportedChainIds","TokenList","assets","account","tokens","data","balances","t","tokensIncludingBalances","token","index","balance","some","asset","EthBalance","mutate","subscribe","on","event","undefined","toNumber","TokenBalance","topics","state","fromAddress","toAddress","amount","update","add","sub","Wallet","props","isStaPage","poolContractAddress","cookies","setCookie","defaultWalletClosed","statera_dashboard_wallet_closed","walletClosed","setWalletClosed","library","activate","deactivate","active","onClick","onWalletChange","handleWalletChange","status","path","console","log","poolAssets","currentPool","push","find","mapValues","value","key","forEach","assetItem","ethBalanceDom","liquidityDom","title","actionsDom","width","marginBottom","provider","Map","refreshInterval","container","closed","inner","header","walletStatus","headerTitle","closeIcon","main","myWallet","tokenList","myLiquidity","actions","containerDisconnected","connectContainer","connectContainerText","margin"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport classes from './Wallet.module.scss'\r\nimport StaButton from '../StaButton/StaButton'\r\nimport { useWeb3React, Web3ReactProvider, getWeb3ReactContext } from '@web3-react/core'\r\nimport { injected, walletConnect } from '../../web3/connectors'\r\nimport Big from 'big.js'\r\nimport { POOLS, ASSETS } from '../../Constants/Constants'\r\nimport _ from 'lodash'\r\nimport { Web3Provider } from '@ethersproject/providers'\r\nimport { InjectedConnector } from '@web3-react/injected-connector'\r\nimport { BigNumber } from 'ethers'\r\nimport { Zero } from '@ethersproject/constants'\r\nimport { formatEther, formatUnits } from '@ethersproject/units'\r\nimport useEthSWR, { EthSWRConfig } from 'ether-swr'\r\nimport ERC20ABI from '../../Constants/ERC20.abi.json'\r\nimport useEtherSWR from 'ether-swr/esm'\r\nimport { genFormattedNumber } from '../../util/numberFormat'\r\nimport WalletStatus from '../WalletStatus/WalletStatus'\r\nimport cx from 'classnames'\r\nimport { useCookies } from 'react-cookie'\r\n\r\nexport const Networks = {\r\n  MainNet: 1,\r\n}\r\n\r\nexport interface IERC20 {\r\n  symbol: string\r\n  address: string\r\n  decimals: number\r\n  name: string\r\n}\r\n\r\nexport const TOKENS_BY_NETWORK: {\r\n  [key: number]: IERC20[]\r\n} = {\r\n  [Networks.MainNet]: ASSETS\r\n    .filter((item:any) => item.ticker !== 'ETH')\r\n    .map((item:any) => ({\r\n      name: item.name,\r\n      symbol: item.ticker,\r\n      address: item.contractAddress,\r\n      decimals: 18,\r\n    }))\r\n}\r\n\r\nexport const ABIs = (chainId: number) => {\r\n  const matrix = TOKENS_BY_NETWORK[chainId]\r\n  return Object.entries(\r\n    matrix.reduce((memo, item) => {\r\n      return { ...memo, [item.address]: ERC20ABI }\r\n    }, {})\r\n  )\r\n}\r\n\r\nexport const injectedConnector = new InjectedConnector({\r\n  supportedChainIds: [\r\n    Networks.MainNet, // Mainet\r\n  ]\r\n})\r\n\r\nexport const TokenList = ({\r\n  chainId,\r\n  assets,\r\n}: {\r\n  chainId: number,\r\n  assets: any,\r\n  isLiquidity: any,\r\n}) => {\r\n  const { account } = useWeb3React<Web3Provider>()\r\n  const tokens = TOKENS_BY_NETWORK[chainId]\r\n\r\n  const { data: balances } = useEtherSWR<BigNumber[]>(\r\n    tokens.map(t => [t.address, 'balanceOf', account!])\r\n  )\r\n\r\n  let tokensIncludingBalances\r\n  if (balances) {\r\n    tokensIncludingBalances = TOKENS_BY_NETWORK[chainId].map((token, index) => ({\r\n        ...token,\r\n        balance: balances[index],\r\n    }))\r\n  }\r\n\r\n  if (tokensIncludingBalances) {\r\n    return (\r\n      <table>\r\n        {\r\n          tokensIncludingBalances\r\n            .filter(token => _.some(assets, asset => asset.contractAddress === token.address))\r\n            .map(token => <TokenBalance key={token.address} {...token} />)\r\n        }\r\n      </table>\r\n    )\r\n  } else {\r\n    return <table>...</table>\r\n  }\r\n}\r\n\r\nexport const EthBalance = () => {\r\n  const { account } = useWeb3React<Web3Provider>()\r\n  const { data: balance, mutate } = useEthSWR(\r\n    ['getBalance', account, 'latest'],\r\n    {\r\n      subscribe: [\r\n        {\r\n          name: 'block',\r\n          on: (event: any) => {\r\n            // on every block we check if Ether balance has changed by re-fetching\r\n            mutate(undefined, true)\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  )\r\n\r\n  if (!balance) {\r\n    return <td>...</td>\r\n  }\r\n\r\n  return (\r\n    <tr>\r\n      <td>Îž</td>\r\n      <td className={classes.balance}>{ genFormattedNumber(Big(formatEther(balance)).toNumber(), 2) }</td>\r\n    </tr>\r\n  )\r\n}\r\n\r\nexport const TokenBalance = ({\r\n  symbol,\r\n  address,\r\n  decimals\r\n}: {\r\n  symbol: string\r\n  address: string\r\n  decimals: number\r\n}) => {\r\n  const { account } = useWeb3React<Web3Provider>()\r\n\r\n  const { data: balance, mutate } = useEthSWR([address, 'balanceOf', account], {\r\n    subscribe: [\r\n      // A filter from anyone to me\r\n      {\r\n        name: 'Transfer',\r\n        topics: [null, account],\r\n        on: (\r\n          state: BigNumber,\r\n          fromAddress: string,\r\n          toAddress: string,\r\n          amount: BigNumber,\r\n          event: any\r\n        ) => {\r\n          const update = state.add(amount)\r\n          mutate(update, false) // optimistic update skip re-fetch\r\n        }\r\n      },\r\n      // A filter from me to anyone\r\n      {\r\n        name: 'Transfer',\r\n        topics: [account, null],\r\n        on: (\r\n          state: BigNumber,\r\n          fromAddress: string,\r\n          toAddress: string,\r\n          amount: BigNumber,\r\n          event: any\r\n        ) => {\r\n          const update = state.sub(amount)\r\n          mutate(update, false) // optimistic update skip re-fetch\r\n        }\r\n      }\r\n    ]\r\n  })\r\n\r\n  if (!balance) {\r\n    return <td>...</td>\r\n  }\r\n\r\n  return (\r\n    <tr>\r\n      <td>{ symbol }</td>\r\n      <td className={classes.balance}>{ genFormattedNumber(Big(formatUnits(balance, decimals)).toNumber(), 2) }</td>\r\n    </tr>\r\n  )\r\n}\r\n\r\nconst Wallet = (props:any) => {\r\n  const { isStaPage, poolContractAddress } = props\r\n  const [cookies, setCookie] = useCookies(['statera_dashboard_wallet_closed']);\r\n  const defaultWalletClosed = cookies.statera_dashboard_wallet_closed === '1' ? true : false\r\n  const [walletClosed, setWalletClosed] = useState(defaultWalletClosed)\r\n\r\n  const { chainId, account, library, activate, deactivate, active } = useWeb3React<Web3Provider>()\r\n\r\n  const onClick = () => {\r\n    activate(injectedConnector)\r\n  }\r\n\r\n  useEffect(() => {\r\n    props.onWalletChange(defaultWalletClosed)\r\n  }, [])\r\n\r\n  const handleWalletChange = (status:boolean) => {\r\n    setWalletClosed(status)\r\n    setCookie('statera_dashboard_wallet_closed', status ? '1' : '0', { path: '/' })\r\n    console.log('cookies: ', status, cookies.statera_dashboard_wallet_closed);\r\n    props.onWalletChange(status)\r\n  }\r\n\r\n  let poolAssets:any = []\r\n  let currentPool:any\r\n  if (isStaPage) {\r\n    poolAssets.push(ASSETS.find(item => item.ticker === 'STA'))\r\n    poolAssets.push(ASSETS.find(item => item.ticker === 'wSTA'))\r\n  } else {\r\n    let currentPool:any\r\n    _.mapValues(POOLS, (value, key) => {\r\n      if (value.contractAddress === poolContractAddress) {\r\n        currentPool = value\r\n      }\r\n    })\r\n    if (currentPool) {\r\n      currentPool.assets.forEach((item:any) => {\r\n        poolAssets.push(ASSETS.find(assetItem => assetItem.contractAddress === item.contractAddress))\r\n      })\r\n    }\r\n  }\r\n\r\n  const ethBalanceDom = _.some(poolAssets, item => item.ticker === \"ETH\") ? <EthBalance /> : null\r\n\r\n  if (active && chainId) {\r\n    let liquidityDom\r\n    if (!isStaPage) {\r\n      liquidityDom = (\r\n        <div>\r\n          <div className={classes.title}>Liquidity</div>\r\n          <TokenList\r\n            chainId={chainId}\r\n            assets={[ASSETS.find(item => item.contractAddress === poolContractAddress)]}\r\n            isLiquidity={false}\r\n          />\r\n        </div>\r\n      )\r\n    }\r\n\r\n    let actionsDom\r\n    if (isStaPage) {\r\n      actionsDom = (\r\n        <div>\r\n          <div className={classes.title}>Actions</div>\r\n          <StaButton\r\n            to=\"https://app.uniswap.org/#/swap?outputCurrency=0xa7de087329bfcda5639247f96140f9dabe3deed1\"\r\n            target=\"_blank\"\r\n            style={{\r\n              width: '100%',\r\n              marginBottom: '10px',\r\n            }}\r\n          >\r\n            Trade STA\r\n          </StaButton>\r\n\r\n          <StaButton\r\n            to=\"https://app.uniswap.org/#/swap?outputCurrency=0xedeec5691f23e4914cf0183a4196bbeb30d027a0\"\r\n            target=\"_blank\"\r\n            style={{\r\n              width: '100%',\r\n              marginBottom: '10px',\r\n            }}\r\n          >\r\n            Trade wSTA\r\n          </StaButton>\r\n        </div>\r\n      )\r\n    } else {\r\n      if (poolContractAddress === '0xa94700c1a1ae21324e78d5bdf6b2924e45a6068f') {\r\n        // Dual asset\r\n        // WARNING: Hardcoding links for STA/wSTA pool\r\n        // TOOD: refactor\r\n        actionsDom = (\r\n          <div>\r\n            <div className={classes.title}>Actions</div>\r\n            <StaButton\r\n              to=\"https://app.uniswap.org/#/add/0xa7de087329bfcda5639247f96140f9dabe3deed1/0xedeec5691f23e4914cf0183a4196bbeb30d027a0\"\r\n              target=\"_blank\"\r\n              style={{\r\n                width: '100%',\r\n                marginBottom: '10px',\r\n              }}\r\n            >\r\n              Add Liquidity\r\n            </StaButton>\r\n\r\n            <StaButton\r\n              to=\"https://app.uniswap.org/#/remove/0xa7de087329bfcda5639247f96140f9dabe3deed1/0xedeec5691f23e4914cf0183a4196bbeb30d027a0\"\r\n              target=\"_blank\"\r\n              style={{\r\n                width: '100%',\r\n                marginBottom: '10px',\r\n              }}\r\n            >\r\n              Remove Liquidity\r\n            </StaButton>\r\n          </div>\r\n        )\r\n      } else {\r\n        actionsDom = (\r\n          <div>\r\n            <div className={classes.title}>Actions</div>\r\n            <StaButton\r\n              to={`https://pools.balancer.exchange/#/pool/${poolContractAddress}`}\r\n              target=\"_blank\"\r\n              style={{\r\n                width: '100%',\r\n                marginBottom: '10px',\r\n              }}\r\n            >\r\n              Add/Remove Liquidity\r\n            </StaButton>\r\n\r\n            <StaButton\r\n              to=\"https://claim.balancer.finance\"\r\n              target=\"_blank\"\r\n              style={{\r\n                width: '100%',\r\n                marginBottom: '10px',\r\n              }}\r\n            >\r\n              Claim BAL Rewards\r\n            </StaButton>\r\n          </div>\r\n        )\r\n      }\r\n    }\r\n\r\n    return (\r\n      <EthSWRConfig\r\n        value={{\r\n          provider: library,\r\n          ABIs: new Map(ABIs(chainId)),\r\n          refreshInterval: 30000\r\n        }}\r\n      >\r\n        <div className={cx(\r\n          classes.container,\r\n          {\r\n            [classes.closed]: walletClosed,\r\n          }\r\n        )}>\r\n          <div className={classes.inner}>\r\n            <div\r\n              className={classes.header}\r\n              onClick={() => {if (walletClosed) { handleWalletChange(false) }}}\r\n            >\r\n              <div className={classes.walletStatus}>\r\n                <WalletStatus\r\n                  account={account}\r\n                  onDisconnect={() => deactivate()}\r\n                />\r\n              </div>\r\n              <div className={classes.headerTitle}>My Wallet</div>\r\n              <div\r\n                className={classes.closeIcon}\r\n                onClick={() => handleWalletChange(!walletClosed)}\r\n              />\r\n            </div>\r\n\r\n            <div className={classes.main}>\r\n              <div className={classes.myWallet}>\r\n                <div className={classes.title}>Balances</div>\r\n                <div className={classes.tokenList}>\r\n                  { ethBalanceDom }\r\n                  <TokenList\r\n                    chainId={chainId}\r\n                    assets={poolAssets}\r\n                    isLiquidity={false}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className={classes.myLiquidity}>\r\n                <div className={classes.tokenList}>\r\n                  { liquidityDom }\r\n                </div>\r\n              </div>\r\n\r\n              <div className={classes.actions}>\r\n                { actionsDom }\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </EthSWRConfig>\r\n    )\r\n  } else {\r\n    return (\r\n      <div className={cx(\r\n        classes.container,\r\n        classes.containerDisconnected,\r\n        {\r\n          [classes.closed]: walletClosed,\r\n        }\r\n      )}>\r\n        <div className={classes.inner}>\r\n          <div\r\n            className={classes.header}\r\n            onClick={() => {if (walletClosed) { handleWalletChange(false) }}}\r\n          >\r\n            <div className={classes.walletStatus}>\r\n              <WalletStatus />\r\n            </div>\r\n            <div className={classes.headerTitle}>My Wallet</div>\r\n            <div\r\n              className={classes.closeIcon}\r\n              onClick={() => handleWalletChange(!walletClosed)}\r\n            />\r\n          </div>\r\n\r\n          <div className={classes.connectContainer}>\r\n            <div className={classes.connectContainerText}>Connect your wallet to see live balances and liquidity</div>\r\n            <StaButton\r\n              onClick={() => { activate(injected) }}\r\n              style={{\r\n                margin: '0 6px 10px',\r\n              }}\r\n            >\r\n              Connect with Metamask\r\n            </StaButton>\r\n\r\n            <StaButton\r\n              onClick={() => { activate(walletConnect, undefined, true) }}\r\n              style={{\r\n                margin: '0 6px 10px',\r\n              }}\r\n            >\r\n              Connect with Walletconnect\r\n            </StaButton>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Wallet\r\n"]},"metadata":{},"sourceType":"module"}